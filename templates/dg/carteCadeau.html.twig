{% extends 'base.html.twig' %}
{# CARTE CADEAU ORGANISATION :
DS OU DR : GRAHIQUE QUE DE LEUR SITE ou LEURS SITES, graphique par site ou par date 
DG : GRAPHIQUE NATONALE, graphique donnée nationale par site ou date

DONC ROUTE DIFFERENTE, CONTROLLER DIFFERENT ET FIND DIFFERENT
DR OU DS -> données par  DATE
DG : DONNEE PAR SITE ET PAR ANNEE

UN ROLE SPECIAL POUR PIERRE OU LE DEV POUR JUSTE AJOUTER DES CHAMPS POUR CAS SPECIFIQUE DONC IS GRANTED et bim
#}


{% block title %}ROLE = DG{% endblock %}

{% block body %}
{% if is_granted('ROLE_ADMIN') %}
<div class="row row-cols-1 row-cols-md-2 row-cols-mlg-6 g-4 mt-3 mb-5 ms-2 me-2">
    <div class="col">
        <div class="card">
        <div class="card-body">
            <canvas id="myChart" width="100" height="100"></canvas>
        </div>
        </div>
    </div>

    <div class="col">
    <h3>
        <table class="table table-bordered mx-auto">
            <thead class="bg-dark text-white my-5">
                <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Nombre de cartes vendues</th>
                    <th scope="col">Valorisation des ventes</th>
                    <th scope="col">Nombre de cartes utilisées</th>
                    <th scope="col">Valorisation des utilisations</th>
                    <th scope="col">Solde</th>
                </tr>
            </thead>
            <tbody>
                {% if cartesCadeauxTableau is not empty %}
                    {% for carteCadeauTableau in cartesCadeauxTableau %}
                        <tr class="bg-light">
                            <td> {{carteCadeauTableau.site}}</td>
                        </tr>
                            {% for carteCadeauTableau in cartesCadeauxTableau %}
                                <tr>
                                    <td> {{carteCadeauTableau.date | date('d/m/Y')}}</td>
                                    <td> {{carteCadeauTableau.nombreCartesVendues}}</td>
                                    <td> {{carteCadeauTableau.valorisationVentes}}</td>
                                    <td> {{carteCadeauTableau.nombreCarteUtilisees}}</td>
                                    <td> {{carteCadeauTableau.valorisationUtilisation}}</td>
                                    <td> {{carteCadeauTableau.solde}}</td>
                                </tr>
                            {% endfor %}
                {% else %}
                    <h2 class="text-danger text-center mt-5 mb-5">Veuillez rajouter une carte cadeau à votre site</h2>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>  
    </div>
</div>
{% endif %}

<script>
var ctx = document.getElementById('myChart');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["31/01/2016" ,"29/02/2016","31/03/2016","30/04/2016","31/05/2016","30/06/2016","31/07/2016","31/08/2016","30/09/2016","31/10/2016","30/11/2016", "31/12/2016"],
        datasets: [{
            label: 'Nombre de cartes vendues par mois',
            data: {{ cartesvendues|raw }},
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
            ],
            borderColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 99, 132, 0.2)',
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>

{% endblock %}

{% block javascripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js" integrity="sha512-Wt1bJGtlnMtGP0dqNFH1xlkLBNpEodaiQ8ZN5JLA5wpc1sUlk/O5uuOMNgvzddzkpvZ9GLyYNa8w2s7rqiTk5Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}